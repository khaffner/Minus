version: '3'
services:
  #################################################  
  gps:
    restart: unless-stopped
    devices:
      - /dev/serial0:/dev/gps # Consider device by ID
    environment:
      - TZ=Europe/Oslo
    build:
      context: ./gps
      dockerfile: Dockerfile
    volumes:
      - /home/minus/logs/gps:/gps
  #################################################  
  homeassistant:
    image: homeassistant/raspberrypi3-64-homeassistant
    network_mode: host
    restart: unless-stopped
    environment:
      - TZ=Europe/Oslo
    volumes:
      - /home/minus/homeassistant_config:/config
      - /home/minus/logs:/logs:RO
  #################################################
  obd:
    restart: unless-stopped
    devices:
      - '/dev/ttyAMA0:/dev/obd'
    environment:
      - TZ=Europe/Oslo
    build:
      context: ./obd
      dockerfile: Dockerfile
    volumes:
      - /home/minus/logs/obd:/obd
  #################################################
  rclone:
    restart: unless-stopped
    environment:
      - TZ=Europe/Oslo
    build:
      context: ./rclone
      dockerfile: Dockerfile
    volumes:
      - /home/minus/.config/rclone:/config/rclone # Must be configured on host
      - /home/minus/logs:/logs
  #################################################
  portainer-ce:
    restart: unless-stopped
    image: portainer/portainer-ce:latest
    environment:
      - TZ=Europe/Oslo
    ports:
      - '8000:8000'
      - '9000:9000'
    volumes:
      - '/var/run/docker.sock:/var/run/docker.sock'
      - '/home/minus/portainer_data:/data'
  #################################################
  blink1:
    restart: unless-stopped
    build:
      context: ./blink1
      dockerfile: Dockerfile
    ports:
      - '8080:8080'
    devices:
      - '/dev/hidraw0'
  #################################################
  glances:
    image: nicolargo/glances:3.2.4.2 # https://github.com/home-assistant/core/issues/70373. Switch back to latest when issue is resolved
    restart: unless-stopped
    pid: host
    ports:
      - '61208:61208'
    environment:
      - GLANCES_OPT=-w
    volumes:
      - '/var/run/docker.sock:/var/run/docker.sock:ro'
